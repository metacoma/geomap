<!DOCTYPE html>
<html>
<head>
<script type="text/javascript">
var ZoomChartsLicense = "ZCS-sb21b1283: ZoomCharts SDK Single Developer Licencefor sry..@..re.io (valid for development only); upgrades until: 2019-07-23";
var ZoomChartsLicenseKey = "7265a822079a2c24f49fd9dfb9fa197291b0c0033238810ec0"+
"967505025094c92ec4af756ffacd650aa736bf13173521b285ccc2599fc023dfd4d60f66786ec"+
"ee7a45796e937743c37d274b3cb726016dac5d1b728577aea56e3106992041f1f74cca0b65932"+
"b176b3a144626adc8582508cd2c002d43a5eb5fef127145c763a8345ac768fca9c887b96bec8b"+
"62c3c1e2be4f47539970acd91114af240e30859d326a41a086e57abbb5f88aae87ffef7bb73fb"+
"24bf44679e5206d582f0b6b0f77f84697a6b8baf443832455a78f8a299df1ea9fb9bc00b3f60d"+
"0cf31ac3bb473d11b83f658ea4490756eec99dd185eb092bbc2d44442f3e6237867c66c66519e";
</script>


  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Pie Chart on Geo Chart.</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <script
    type="text/javascript"
    src="//code.jquery.com/jquery-1.12.4.js"
    
  ></script>

    <link rel="stylesheet" type="text/css" href="/css/result-light.css">

  <style type="text/css">
    
  </style>
  
</head>
<body>
  <script src="https://cdn.zoomcharts-cloud.com/1/latest/zoomcharts.js"></script>
<content>
    <div id="demo"></div>

</content>

  <!-- TODO: Missing CoffeeScript 2 -->

  <script type="text/javascript">


    

    var hasProp = {}.hasOwnProperty;
    var sliceColors = ["#2fc32f", "#b0dc0b", "#eab404", "#de672c"];
    var enableAggregation = true;
    var options = {
        area: { height: null },
        container: document.getElementById("demo"),
        background:{
            url: "https://maps.zoomcharts.com/{z}/{x}/{y}.png"
        },
        data:[
            {
                id: "gdp",
                url: "https://zoomcharts.com/dvsl/data/geo-chart/nominal_gdp_composition.json",
                perBoundsData: false
            }
        ],
        layers:[
            {
                id: "piePositions",
                type: "items",
                data: {
                    id: "gdp"
                },
                aggregation: {
                    enabled: true,
                    distance: 70,
                    weightFunction: function (node) {
                        var sum = 0;
                        for (var key in node.gdp) {
                            if (hasProp.call(node.gdp, key)) {
                                sum += node.gdp[key];
                            }
                        }
                        return sum;
                    }
                },
                style: {
                    nodeAutoScaling: null,
                    nodeStyleFunction: function (node) {
                        var r;
                        if (enableAggregation) {
                            r = node.data.aggregatedWeight;
                        } else {
                            r = 0;
                            for (var key in node.data.gdp) {
                                if (hasProp.call(node.data.gdp, key)) {
                                    r += node.data.gdp[key];
                                }
                            }
                        }
                        // in order to fit nodes on the chart, display the radius in a logarithmic scale
                        node.radius = Math.log(Math.max(2, r * 1e-6)) * 15;

                        // Show the country names, if an aggregation contains only 1 node
                        var aggr;
                        if (enableAggregation) {
                            aggr = node.data.aggregatedNodes;
                        } else {
                            aggr = [node];
                        }
                        if (aggr.length === 1) {
                            node.label = aggr[0].id;
                        } else {
                            node.display = "image";
                            node.label = "" + aggr.length + "&nbsp;countries";
                        }
                    },
                    node: {
                        radius: void 0,
                        fillColor: "rgba(0, 0, 0, 0.9)",
                        lineColor: null,
                        label: "",
                        display: "droplet"
                    },
                    nodeHovered: {
                        shadowColor: "black"
                    },
                    nodeLabel: {
                        backgroundStyle: {
                            fillColor: "rgba(0, 0, 0, 0.9)",
                            lineColor: "rgba(0, 0, 0, 0.9)"
                        },
                        textStyle: {
                            fillColor: "#ccc"
                        }
                    },
                    removedColor: null
                }
            }, {
                id: "pie",
                type: "charts",
                shapesLayer:"piePositions",
                chartType: "piechart",
                settingsFunction: function (node, data) {
                    var aggr;
                    if (enableAggregation) {
                        aggr = data.aggregatedNodes;
                    } else {
                        aggr = [data];
                    }

                    if (aggr.settingsApplied) return {
                        pie: { radius: node.removed ? 1e-30 : node.radius - 3, innerRadius: 5 }
                    };
                    aggr.settingsApplied = true;

                    var pieData = {subvalues: []};

                    // When displaying aggregated GDP of a region, summarize the GDP sectors
                    var gdp = {
                        Agriculture: 0,
                        Industry: 0,
                        Service: 0
                    };
                    for (var i = 0; i < aggr.length; i++) {
                        var c = aggr[i];
                        for (var j in c.gdp) {
                            if (hasProp.call(gdp, j)) {
                                gdp[j] += c.gdp[j];
                            }
                        }
                    }
                    var radius = 0;
                    for (var key in gdp) {
                        if (hasProp.call(gdp, key)) {
                            pieData.subvalues.push({
                                value: gdp[key],
                                name: key
                            });
                        }
                    }
                    return {
                        pie: {
                            radius: node.radius - 3,
                            innerRadius: 5,
                            style: {
                                sliceColors: sliceColors,
                                colorDistribution: "list"
                            }
                        },
                        data: {
                            preloaded: pieData
                        },
                        labels: {enabled: false},
                        info: {
                            contentsFunction: function (data) {
                                return "" + data.name + " " + data.value.toLocaleString() + "M $";
                            }
                        }
                    };
                }
            }
        ],
        navigation:{
            initialLat: 30,
            initialLng: 10,
            initialZoom: 2
        }
    };
    chart = new GeoChart(options);

    var toggle = document.getElementById("enableAggr");
    if (toggle) {
        toggle.addEventListener("change", function () {
            enableAggregation = this.checked;
            options.layers[0].aggregation.enabled = enableAggregation;
            chart.updateSettings({
                layers: options.layers
            });
        });
    }



</script>

  <script>
    // tell the embed parent frame the height of the content
    if (window.parent && window.parent.parent){
      window.parent.parent.postMessage(["resultsFrame", {
        height: document.body.getBoundingClientRect().height,
        slug: "364c1gd8"
      }], "*")
    }
  </script>
</body>
</html>

